#!/usr/bin/env bash

usage () {
cat <<HELP_USAGE
$0 

Install dependency packages required to run an exitnode.
HELP_USAGE
}

set -e

release_info="$(cat /etc/*-release)"
echo "release_info=$release_info"
release_name="$(echo "$release_info" | grep ^NAME= | cut -d'=' -f2)"
echo "release_name=$release_name"


# Upgrade kernel on OS that require it
echo "release_name=$release_name"
if [ "$release_name" == '"Ubuntu"' ]; then
  echo "OS is Ubuntu. Need to upgrade kernel"
  # This would NOT work on Debian 8.10, (@TODO test others).
  # It does work on Ubuntu 16.04
  apt-get install -yq \
    linux-image-extra-"$(uname -r)"
fi

apt-get install -yq \
  build-essential \
  ca-certificates \
  curl \
  git \
  zlib1g \
  zlib1g-dev \
  libssl-dev \
  libxslt1-dev \
  module-init-tools \
  bridge-utils \
  openssh-server \
  openssl \
  perl \
  dnsmasq \
  procps \
  python-psycopg2 \
  python-software-properties \
  software-properties-common \
  python \
  python-dev \
  python-pip \
  iproute \
  libnetfilter-conntrack3 \
  libevent-dev \
  ebtables \
  vim \
  tmux

apt-get install -yq \
  cmake \
  libnl-3-dev \
  libnl-genl-3-dev \
  build-essential \
  pkg-config
